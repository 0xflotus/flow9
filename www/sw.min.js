var CACHE_NAME="flow-cache",rangeResourceCache="flow-range-cache",dynamicResourcesExtensions=[".php",".serverbc"],CacheMode={PreferCachedResources:!1,CacheStaticContent:!0};function initializeCacheStorage(){return caches.open(CACHE_NAME).then(function(){return console.log("Opened cache"),Promise.resolve()})}self.addEventListener("install",function(a){a.waitUntil(initializeCacheStorage())}),self.addEventListener("fetch",function(a){var b=function(b){a.clientId&&setTimeout(function(){clients.get(a.clientId).then(function(a){a.postMessage(b)})},5)},c=function(){if(!a.clientId)return Promise.reject();var b=new URL(a.request.url);return clients.get(a.clientId).then(function(a){var c=new URL(a.url);return b.pathname.endsWith("/php/stamp.php")&&b.searchParams.get("file")==c.searchParams.get("name")+".js"?Promise.resolve():Promise.reject()})},d=function(c){return caches.match(a.request,{ignoreSearch:c}).then(function(c){return c?(b({msg:"Responded with cache:",url:a.request.url}),c):Promise.reject()})},e=function(){return c().then(function(){return d(!0)}).catch(function(){return d(!1)})},f=function(){return fetch(a.request,{credentials:"include"}).then(function(d){if(CacheMode.CacheStaticContent&&200==d.status&&"basic"==d.type){var e=new URL(a.request.url);return Promise.all(dynamicResourcesExtensions.map(function(a){return e.pathname.endsWith(a)?c().then(function(){return caches.open(CACHE_NAME).then(function(a){return a.delete(self.registration.scope+"php/stamp.php",{ignoreSearch:!0}).then(function(){return a.delete(self.registration.scope+e.searchParams.get("file"),{ignoreSearch:!0})})})}):Promise.resolve()})).then(function(){return caches.open(CACHE_NAME).then(function(c){c.put(a.request,d),b({msg:"Cached resource:",url:a.request.url})}),d.clone()}).catch(function(){return d})}return d})};a.request.headers.get("range")?a.respondWith(function(){return caches.open(rangeResourceCache).then(function(b){return b.match(a.request.url)}).then(function(b){return b?b:fetch(a.request).then(function(b){if(200==b.status){var c=b.clone();return caches.open(rangeResourceCache).then(function(b){return b.put(a.request,c)}).then(function(){return b})}return b})}).then(function(b){return 200==b.status?b.arrayBuffer().then(function(c){var d=/^bytes\=(\d+)\-(\d+)?$/g.exec(a.request.headers.get("range"));if(d){var e=+d[1],f=+d[2]||c.byteLength-1;return new Response(c.slice(e,f+1),{status:206,statusText:"Partial Content",headers:[["Content-Type",b.headers.get("Content-Type")],["Content-Range","bytes "+e+"-"+f+"/"+c.byteLength]]})}return new Response(null,{status:416,statusText:"Range Not Satisfiable",headers:[["Content-Range","*/"+c.byteLength]]})}):b})}()):a.respondWith(function(){return CacheMode.PreferCachedResources?e().catch(function(){return f()}):f().catch(function(){return e()})}())}),self.addEventListener("activate",function(){caches.delete(rangeResourceCache),console.log("cache cleared",rangeResourceCache),caches.keys().then(function(a){return Promise.all(a.map(function(a){if(CACHE_NAME!=a)return caches.delete(a)}))})}),self.addEventListener("message",function(a){var b=function(b){0<a.ports.length?a.ports[0].postMessage(b):console.error("Failed to respond!")},c=function(a){a.then(function(){b({status:"OK"})}).catch(function(){b({status:"Failed"})})};"get_cache_version"==a.data.action?b({cache_version:SW_CACHE_VERSION}):0<a.data.action.indexOf("_cache_resources")?c(caches.open(CACHE_NAME).then(function(b){return Promise.all(a.data.urls.map(function(c){if("add_cache_resources"==a.data.action)return b.add(c);return"remove_cache_resources"==a.data.action?b.delete(c):void 0}))})):"get_cache_storage_names"==a.data.action?caches.keys().then(function(a){b({names:a})}):"remove_cache_storage"==a.data.action&&c(caches.delete(a.data.action.name))});