Behaviour<?> ::= ConstBehaviour<?>, DynamicBehaviour<?>;
DynamicBehaviour(value : ref ?);
ConstBehaviour : (constv : ?);

make : (?) -> DynamicBehaviour<?>;

make(value) {
	DynamicBehaviour(ref value);
}

next(b : DynamicBehaviour<?>, value : ?) -> void {}

subscribe2(b : Behaviour<?>, fb: (?) -> void) -> () -> void {
	\ -> {}
}

TextInputState ::= TextSize, Selection;

TextSize(width : double, height : double);
Selection(start : int, end : int);

TTextInput() -> void {
	stateChange = make([]);
	selectionB = make(Selection(1, 1)); 

	getSmartTextSize : () -> TextSize = \ -> {
		if (true) {
			TextSize(0.0, 0.0)
		} else {
			TextSize(1.0, 0.0)
		}
	};

	next(stateChange, [getSmartTextSize()]);
	subscribe2(selectionB, \selection : Selection -> {
		next(stateChange, [selection]);
	});		
	{}
}

----------

make = (\value:? ->
	(DynamicBehaviour((ref (value : ?) : ref ?)) : DynamicBehaviour<?>)
 : (value : ?) -> DynamicBehaviour<?>);

next = (\b:DynamicBehaviour<?>, value:? ->
	({} : void)
 : (b : DynamicBehaviour<?>, value : ?) -> void);

subscribe2 = (\b:Behaviour<?>, fb:(?) -> void ->
	(\ ->
		({} : void)
	 : () -> void)
 : (b : Behaviour<?>, fb : (?) -> void) -> () -> void);

TTextInput = (\ ->
	(stateChange : DynamicBehaviour<[TextInputState]> = ((make : (value : [TextInputState]) -> DynamicBehaviour<[TextInputState]>)(([] : [TextInputState])) : DynamicBehaviour<[TextInputState]>);
	({
		(selectionB : DynamicBehaviour<Selection> = ((make : (value : Selection) -> DynamicBehaviour<Selection>)((Selection((1 : int), (1 : int)) : Selection)) : DynamicBehaviour<Selection>);
		({
			(getSmartTextSize : () -> TextSize = (\ ->
				(if ((true : bool)) {
					(TextSize((0.0 : double), (0.0 : double)) : TextSize)
				} else {
					(TextSize((1.0 : double), (0.0 : double)) : TextSize)
				}
				 : TextSize)
			 : () -> TextSize);
			({
				((next : (b : DynamicBehaviour<[TextInputState]>, value : [TextInputState]) -> void)((stateChange : DynamicBehaviour<[TextInputState]>), ([((getSmartTextSize : () -> TextSize)() : TextSize)] : [TextSize])) : void);
				((subscribe2 : (b : Behaviour<Selection>, fb : (Selection) -> void) -> () -> void)((selectionB : DynamicBehaviour<Selection>), (\selection:Selection ->
					((next : (b : DynamicBehaviour<[TextInputState]>, value : [TextInputState]) -> void)((stateChange : DynamicBehaviour<[TextInputState]>), ([(selection : Selection)] : [Selection])) : void)
				 : (selection : Selection) -> void)) : () -> void);
				({} : void)
			}
			 : void) : void)
		}
		 : void) : void)
	}
	 : void) : void)
 : () -> void);
