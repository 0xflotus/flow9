import tools/flowc/backends/wasm/wasm_type;
import tools/flowc/fcexp;

export {
	// This mirrors FiExp with some extensions
	WasmExp ::= WasmLambda, WasmCall, WasmCallNative, WasmCallHost, WasmVar, WasmLet, WasmIf, WasmSwitch, WasmCast, WasmSeq, 
			  WasmCallPrim, WasmConst, WasmRequire, WasmUnsafe;
		WasmLambda(args: [WasmFunArg], body: WasmExp, type : WasmTypeDescriptor, id : int);
		WasmCall(f: WasmExp, args: [WasmExp], type : WasmTypeDescriptor, id : int);
		WasmCallNative(f: WasmExp, args: [WasmExp], type : WasmTypeDescriptor, id : int);
		WasmCallHost(f: WasmExp, args: [WasmExp], type : WasmTypeDescriptor, id : int);
		WasmVar(name: string, type : WasmTypeDescriptor, id : int);
		WasmLet(name: string, type : WasmTypeDescriptor, e1: WasmExp, e2: WasmExp, type2 : WasmTypeDescriptor, id : int);
		WasmIf(e1: WasmExp, e2: WasmExp, e3: WasmExp, type : WasmTypeDescriptor, id : int);
		WasmSwitch(x: WasmVar, switchType : WasmTypeDescriptor, cases: [WasmCase], type : WasmTypeDescriptor, id : int);
			// struct is "default" for default case
			WasmCase(struct: string, argNames : [string], body: WasmExp, id : int);
		WasmCast(e: WasmExp, tFrom : WasmTypeDescriptor, tTo : WasmTypeDescriptor, type : WasmTypeDescriptor, id : int);
		WasmSeq(es: [WasmExp], type : WasmTypeDescriptor, id : int);
		WasmCallPrim(op: FcPrim, es: [WasmExp], type : WasmTypeDescriptor, id : int);
		WasmRequire(flowWasmle : string, e : WasmExp, type : WasmTypeDescriptor, id : int);
		WasmUnsafe(name : string, fallback : WasmExp, type : WasmTypeDescriptor, id : int);

	WasmConst ::= WasmVoid, WasmDouble, WasmInt, WasmString, WasmBool;
		WasmVoid(id : int);
		WasmDouble(d : double, id : int);
		WasmInt(i : int, id : int);
		WasmString(s : string, id : int);
		WasmBool(b: bool, id : int);
}
