export {
	IuWikiPreprocessor : IuPreprocessor;
	wikiPreprocessDouble(source : string) -> Pair<bool, double>;
}
import illusion/illusion_preprocessor;
import formats/wiki/wikivariables;

DefaultPreprocessDouble(d : IuDoubleVar) -> Behaviour<Pair<bool, double>> {
	select(d.source, wikiPreprocessDouble);
}

wikiPreprocessDouble(source) {
	pr : WV_ParseResult = parseWikiVariables(source);
	switch(pr) {
		WV_CorrectResult(sequence, remainder) : {
			if (isNotSpace(remainder.s)) {
				Pair(false, 0.0)
			} else {
				Pair(true, sequence |> processWVSequence |> s2d)
			}
		}
		WV_RemainderOnly(remainder) : {
			Pair(false, 0.0)
		}
	}
}

IuWikiPreprocessor = IuPreprocessor(makeIntPreprocessor(DefaultPreprocessDouble), DefaultPreprocessDouble);
