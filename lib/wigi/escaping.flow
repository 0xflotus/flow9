import paragraphtypes;
import string;

export {
	escapeXmlCharsInWords(words : List<WrapElement>) -> List<WrapElement>;
	escapeXmlChars(s : string) -> string;
}

escapeXmlCharsInWords(words : List<WrapElement>) -> List<WrapElement> {
	mapList(words, escapeXmlCharsInWrapElement);
}

escapeXmlCharsInWrapElement(w : WrapElement) -> WrapElement {
	switch (w : WrapElement ) {
		InspectElement(i, x, y, size, lineHeight, e): {
			escaped = switch (e : InspectableElement) {
				Text(t, s): Text(escapeXmlChars(t), s);
				Space(s): e;
				default: e;
			}
			
			InspectElement(i, x, y, size, lineHeight, escaped);
		}
		default: w;
	}
}

escapeXmlChars(s : string) -> string {
	s1 = strReplace(s, "&", "&amp;");
	s2 = strReplace(s1, "<", "&lt;");
	strReplace(s2, ">", "&gt;");
}
