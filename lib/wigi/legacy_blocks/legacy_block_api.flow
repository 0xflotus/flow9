import formats/wiki/wikistyle_types;
import wigi/editor_types;

export {
	registerLegacyBlockAPI(exType: string, api : LegacyBlockAPI) -> void;
	getLegacyBlockAPI(exType: string) -> Maybe<LegacyBlockAPI>;

	LegacyBlockAPI : (
		block2form : (block : WigiBlock, styles : [LegacyBlockStyle]) -> Form,
		editProperties : (
			state : WigiEditorState,
			blockType : WigiBlockType,
			onOK : (block : WigiBlockType) -> void,
			styles : [LegacyBlockEditPropertiesStyle]
		) -> void
	);

	LegacyBlockStyle ::= IsWigiPreviewMode, WikiStyles, WigiEngine, WigiScope, ShowStructuresM, RegisterToEngine;
		IsWigiPreviewMode(isPreview : bool);
		WikiStyles(styles : [WikiStyle]);
		ShowStructuresM(showStructures : Maybe<ShowStructures>);

	LegacyBlockEditPropertiesStyle ::= WigiScope;
}

legacyBlocks : ref Tree<string, LegacyBlockAPI> = ref makeTree();

registerLegacyBlockAPI(exType: string, api : LegacyBlockAPI) -> void {
	legacyBlocks := setTree(^legacyBlocks, exType, api);
}

getLegacyBlockAPI(exType: string) -> Maybe<LegacyBlockAPI> {
	lookupTree(^legacyBlocks, exType)
}

