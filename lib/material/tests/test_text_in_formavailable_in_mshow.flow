import material/material2tropic;

main() {
	boxSize = make(WidthHeight(0.0, 0.0));
	showSignal = make(true);
	// this variable is a MWigify simulator
	// the MWigify function returns the same TFormAvailable(Text(), TFillXY())
	someFormSimulateMWigify = TFormAvailable(
		Text("SOME TEXT THAT SHOULD BE HIDDEN", []),
		TFillXY()
	) |> \t -> TDebug(red, t);
	// The following construction should hide the Form (someFormSimulateMWigify) 
	// if it does not fit in the established size. 
	someStrangeMaterial = 
		MConstruct(
			[
				makeSubscribe(boxSize, \wh -> 
					updateBehaviourDistinct(
						showSignal, 
						// just some metrics for event generation
						\f -> if (f) wh.width < 120. && wh.height < 32. else false
					)
				)
			],
			MAttachBox(
				MShow(
					showSignal,
					someFormSimulateMWigify
				),
				boxSize
			)
		);
	// it only breaks when the showSignal comes from a resizing event
	// otherwise (click button event) everything works fine
	// MTextButton(
	// 	"click me",
	// 	\-> updateBehaviour(showSignal, \x -> !x),
	// 	[],
	// 	[]
	// )
	mrender(
		makeMaterialManager([]), 
		true,
		MFrame(16.0, 0.0, [Fill(0xCACACA)], someStrangeMaterial)
	)	
}