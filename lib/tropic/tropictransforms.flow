import tropic/tropic2form;

export {
	// Make static copy of a Tropic
	takeTSnapshot : (tropic : Tropic) -> Tropic;
}

// Creates transform with the value as original
__cb(b : Transform<?>) -> Transform<?> {const(fgetValue(b));}

takeTSnapshot(t : Tropic) -> Tropic {
	switch(t : Tropic) {
		TForm(form) : TSFForm(fform2sfform(form2fform(form), false), getStaticFormSize(form)
			|> (\fs -> TFormMetrics(const(fs.width), const(fs.height), const(fs.baseline))));
		TFForm(form, met) : TSFForm(fform2sfform(form, false), met);
		TSFForm(__, __) : t;
		default :
			TSFForm(
				fform2sfform(tropic2fform(t, emptyStylesheet, const(WidthHeight(getStageWidth(), getStageHeight()))), true),
				TFormMetrics(const(getStageWidth()), const(getStageHeight()), const(getStageHeight()))
			);
	}
}