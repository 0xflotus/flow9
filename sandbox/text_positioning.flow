import rendersupport;
import form/renderform;
import form/paragraph;

getGrid(clip: native, w: double, d: double) -> [int] {
	if (w>=0.0) arrayPush(getGrid(clip, w-d, d), findTextFieldCharByPosition(clip, w, 0.0)) else [];
}

getMatrix(clip: native, w: double, i: int) -> [double] {
	if (i>=0) arrayPush(getMatrix(clip, w, i-1), getTextFieldCharXPosition(clip, i)/w) else [];
}

mkclip(text, family, size) -> native {
	println("mkclip");
	htmlFont = font2htmlFont(family);
	println(htmlFont);
	families = htmlFont2familiesString(htmlFont);
	println(families);
	textField = makeTextfield(families);
	setTextAndStyle(textField, text, families, size, htmlFont2weight(htmlFont), htmlFont2slope(htmlFont), 0x000000, 1.0, 0.0, 0x000000, 0.0);
	textField;
}

main() {
	println("Hello console");
	setLang("ar");
	text = "لا ما هو لوريم إيبسوم ؟";
	us = render(
		Paragraph(
			[
				TextFragment(
					text,
					[FontFamily("Book"), FontSize(40.0)]
				)
			],
			[]
		)
	);
	clip = mkclip(text, "Book", 40.0);
	width = getTextFieldWidth(clip);
	println("Width: " + d2s(width));
	println("Grid: " + toString(getGrid(clip, width, width/12.0)));
	println("Matrix: " + toString(getMatrix(clip, width, strlen(text))));
	deleteNative(clip);
}
